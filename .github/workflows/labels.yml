name: Labels

on:
  issues:
    types:
      - opened

jobs:
  label:
    runs-on: ubuntu-latest

    steps:
    - name: Check issue dropdown selection
      id: check_dropdown
      run: |
        # Extract the issue body
        issue_body=$(curl -s -H "Accept: application/vnd.github.v3+json" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} | jq -r .body)

        # Initialize the label variable
        label=""

        # Check if the issue body contains specific keywords
        if echo "$issue_body" | grep -qi "Marketing tools"; then
          echo "::set-output name=label::🛠️ marketing tools"
        elif echo "$issue_body" | grep -qi "Go To Market / New Product"; then
          echo "::set-output name=label::🚀 go to market / new product"
        elif echo "$issue_body" | grep -qi "B2B"; then
          echo "::set-output name=label::🤝 B2B"
        fi

        echo "Label: $label"

        # Store the label in an environment file
        echo "LABEL=$label" >> $GITHUB_ENV
      shell: bash

    - name: Apply labels
      if: env.LABEL
      run: |
        # Get the label from the environment file
        label="${{ env.LABEL }}"

        # Add the label to the issue
        echo "Adding label: $label"
        curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/labels --data '["'$label'"]'
       
