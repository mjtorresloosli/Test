name: Label Issues

on:
  issues:
    types:
      - opened

jobs:
  label:
    runs-on: ubuntu-latest

    steps:
    - name: Check issue body for labels
      id: check_labels
      run: |
        issue_body=$(curl -s -H "Accept: application/vnd.github.v3+json" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} | jq -r .body)

        # Check if the issue body contains specific keywords
        if echo "$issue_body" | grep -qi "Marketing tools"; then
          echo "::set-output name=label::üõ†Ô∏è marketing tools"
        elif echo "$issue_body" | grep -qi "Go To Market / New Product"; then
          echo "::set-output name=label::üöÄ go to market / new product"
        elif echo "$issue_body" | grep -qi "B2B"; then
          echo "::set-output name=label::ü§ù B2B"
        fi
      shell: bash

    - name: Apply labels
      if: steps.check_labels.outputs.label
      run: |
        label="${{ steps.check_labels.outputs.label }}"

        echo "Adding label: $label"
        curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/labels --data '["'$label'"]'
