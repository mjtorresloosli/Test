name: Labels

on:
  issues:
    types:
      - opened

jobs:
  label:
    runs-on: ubuntu-latest

    steps:
    - name: Check issue dropdown selection
      id: check_dropdown
      run: |
        # Extract the issue body
        issue_body=$(curl -s -H "Accept: application/vnd.github.v3+json" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} | jq -r .body)

        # Check if the issue body contains specific keywords
        if echo "$issue_body" | grep -qi "Marketing tools"; then
          echo "::set-output name=label::üõ†Ô∏è marketing tools"
        elif echo "$issue_body" | grep -qi "Go To Market / New Product"; then
          echo "::set-output name=label::üöÄ go to market / new product"
        elif echo "$issue_body" | grep -qi "B2B"; then
          echo "::set-output name=label::ü§ù B2B"
        fi
      shell: bash

    - name: Apply labels
      if: steps.check_dropdown.outputs.label
      run: |
        # Get the label from previous step
        label=${{ steps.check_dropdown.outputs.label }}

        # Add the label to the issue
        echo "Adding label: $label"
        curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" ${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/labels --data '["'$label'"]'
